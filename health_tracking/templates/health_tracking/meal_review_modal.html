{% extends 'base.html' %}
{% load static %}

{% block title %}Rate Meal - {{ block.super }}{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card border-0 shadow">
                <div class="card-header bg-white border-bottom">
                    <h4 class="card-title mb-0">How did this meal make you feel?</h4>
                    <small class="text-muted">Your feedback helps us improve meal offerings and personalize your nutrition</small>
                </div>
                <div class="card-body">
                    <form method="POST" id="mealReviewForm" class="needs-validation" novalidate>
                        {% csrf_token %}
                        
                        <!-- Meal Selection -->
                        <div class="mb-4">
                            <label for="meal_id" class="form-label fw-bold">Which meal are you rating?</label>
                            <select name="meal_id" id="meal_id" class="form-select form-select-lg" required>
                                <option value="">-- Select a meal --</option>
                                {% for meal in meals %}
                                    <option value="{{ meal.id }}">{{ meal.name }}</option>
                                {% endfor %}
                            </select>
                            {% if form.meal_id.errors %}
                                <div class="invalid-feedback d-block">{{ form.meal_id.errors }}</div>
                            {% endif %}
                        </div>

                        <!-- Overall Rating (5 Stars) -->
                        <div class="mb-4">
                            <label class="form-label fw-bold mb-3">Overall Rating</label>
                            <div class="rating-container d-flex gap-2 mb-2">
                                {% for i in "12345" %}
                                    <label class="rating-option-star" title="{{ i }} star{{ i|pluralize }}">
                                        <input type="radio" name="overall_rating" value="{{ i }}" required>
                                        <span class="stars-display fs-4">
                                            {% for j in "x"|rjust:i %}‚≠ê{% endfor %}
                                        </span>
                                    </label>
                                {% endfor %}
                            </div>
                            <small class="text-muted">Select how much you enjoyed this meal</small>
                        </div>

                        <!-- Satisfaction (1-5 Scale) -->
                        <div class="mb-4">
                            <label class="form-label fw-bold mb-3\">Satisfaction Level</label>
                            <div class=\"rating-scale d-flex gap-1 justify-content-between\">
                                <span class=\"small text-muted\">Not Satisfied</span>
                                <div class=\"d-flex gap-2\">
                                    {% for i in \"12345\" %}
                                        <label class=\"rating-option\">
                                            <input type=\"radio\" name=\"satisfaction\" value=\"{{ i }}\" required>
                                            <span class=\"badge\" style=\"cursor: pointer;\">{{ i }}</span>
                                        </label>
                                    {% endfor %}
                                </div>
                                <span class=\"small text-muted\">Very Satisfied</span>
                            </div>
                        </div>

                        <!-- Digestibility (1-5 Scale) -->
                        <div class=\"mb-4\">
                            <label class=\"form-label fw-bold mb-3\">How easy was it to digest?</label>
                            <div class=\"rating-scale d-flex gap-1 justify-content-between\">
                                <span class=\"small text-muted\">Difficult</span>
                                <div class=\"d-flex gap-2\">
                                    {% for i in \"12345\" %}
                                        <label class=\"rating-option\">
                                            <input type=\"radio\" name=\"digestibility\" value=\"{{ i }}\" required>
                                            <span class=\"badge\" style=\"cursor: pointer;\">{{ i }}</span>
                                        </label>
                                    {% endfor %}
                                </div>
                                <span class=\"small text-muted\">Very Easy</span>
                            </div>
                        </div>

                        <!-- Energy Level (1-5 Scale) -->
                        <div class=\"mb-4\">
                            <label class=\"form-label fw-bold mb-3\">Energy level after eating</label>
                            <div class=\"rating-scale d-flex gap-1 justify-content-between\">
                                <span class=\"small text-muted\">Low Energy</span>
                                <div class=\"d-flex gap-2\">
                                    {% for i in \"12345\" %}
                                        <label class=\"rating-option\">
                                            <input type=\"radio\" name=\"energy_level\" value=\"{{ i }}\" required>
                                            <span class=\"badge\" style=\"cursor: pointer;\">{{ i }}</span>
                                        </label>
                                    {% endfor %}
                                </div>
                                <span class=\"small text-muted\">High Energy</span>
                            </div>
                        </div>

                        <!-- Mood After Eating (1-5 Scale) -->
                        <div class=\"mb-4\">
                            <label class=\"form-label fw-bold mb-3\">Mood after eating</label>
                            <div class=\"rating-scale d-flex gap-1 justify-content-between\">
                                <span class=\"small text-muted\">Worse</span>
                                <div class=\"d-flex gap-2\">
                                    {% for i in \"12345\" %}
                                        <label class=\"rating-option\">
                                            <input type=\"radio\" name=\"mood_after\" value=\"{{ i }}\" required>
                                            <span class=\"badge\" style=\"cursor: pointer;\">{{ i }}</span>
                                        </label>
                                    {% endfor %}
                                </div>
                                <span class=\"small text-muted\">Better</span>
                            </div>
                        </div>

                        <hr>

                        <!-- Health Condition Context -->
                        <div class=\"mb-3\">
                            <label for=\"health_condition_at_time\" class=\"form-label\">Your health condition at the time <small class=\"text-muted\">(Optional)</small></label>
                            <input type=\"text\" name=\"health_condition_at_time\" id=\"health_condition_at_time\" 
                                   class=\"form-control\" placeholder=\"e.g., Tired, Stressed, Energetic, Post-Workout\">
                        </div>

                        <!-- Allergies or Issues -->
                        <div class=\"mb-3\">
                            <label for=\"allergies_or_issues\" class=\"form-label\">Any allergic reactions or digestive issues? <small class=\"text-muted\">(Optional)</small></label>
                            <textarea name=\"allergies_or_issues\" id=\"allergies_or_issues\" 
                                      class=\"form-control\" rows=\"2\" placeholder=\"Describe any negative reactions...\"></textarea>
                        </div>

                        <!-- Additional Notes -->
                        <div class=\"mb-3\">
                            <label for=\"notes\" class=\"form-label\">Additional Notes <small class=\"text-muted\">(Optional)</small></label>
                            <textarea name=\"notes\" id=\"notes\" class=\"form-control\" rows=\"2\" 
                                      placeholder=\"Any other observations about the meal...\"></textarea>
                        </div>

                        <!-- Info Box -->
                        <div class=\"alert alert-light border mb-4\" role=\"alert\">
                            <small>
                                <strong>üìä Why we ask:</strong> Your detailed feedback helps our nutritionists and kitchen staff understand how meals impact your health and satisfaction. This information is used to personalize meal recommendations and improve our offerings.
                            </small>
                        </div>

                        <!-- Action Buttons -->
                        <div class=\"d-grid gap-2 d-sm-flex justify-content-sm-end\">
                            <a href=\"{% url 'health_tracking:dashboard_patient' %}\" class=\"btn btn-lg btn-outline-secondary\">
                                Cancel
                            </a>
                            <button type=\"submit\" class=\"btn btn-lg btn-primary\">
                                <i class=\"fas fa-check-circle me-2\"></i>Save Review
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.rating-container {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
}

.rating-option-star {
    cursor: pointer;
    font-size: 1.5rem;
    transition: transform 0.2s;
}

.rating-option-star input[type=\"radio\"] {
    display: none;
}

.rating-option-star:hover {
    transform: scale(1.2);
}

.rating-option-star input[type=\"radio\"]:checked + .stars-display {
    color: #ffc107;
}

.rating-scale .rating-option {
    cursor: pointer;
}

.rating-scale .rating-option input[type=\"radio\"] {
    display: none;
}

.rating-scale .rating-option input[type=\"radio\"]:checked + .badge {
    background-color: #0d6efd !important;
    color: white;
    font-weight: bold;
}

.rating-scale .badge {
    min-width: 2.5rem;
    text-align: center;
    transition: all 0.2s;
}

.rating-scale .badge:hover {
    background-color: #e9ecef !important;
    color: #000 !important;
}
</style>
{% endblock %}