{% extends 'nutritionist_dashboard/base.html' %}
{% load static %}

{% block title %}Nutritionist Dashboard - Dusangire{% endblock %}

{% block dashboard_content %}
<div class="container-fluid">
    <!-- ===== Dashboard Header ===== -->
    <div class="row mb-4">
        <div class="col">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="display-6 fw-bold mb-2">
                        <i class="bi bi-graph-up text-primary me-2"></i> Welcome Back, {{ user.first_name|default:user.username }}!
                    </h1>
                    <p class="text-muted">Manage your clients and meal plans effectively</p>
                </div>
                <div class="d-flex gap-2">
                    <a href="{% url 'nutritionist_dashboard:manage_clients' %}" class="btn btn-outline-primary">
                        <i class="bi bi-people me-1"></i> My Clients
                    </a>
                    <a href="{% url 'nutritionist_dashboard:create_meal_plan' %}" class="btn btn-primary">
                        <i class="bi bi-plus-circle me-1"></i> New Meal Plan
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== Key Statistics Cards ===== -->
    <div class="row g-4 mb-4">
        <!-- Total Clients Card -->
        <div class="col-lg-3 col-md-6">
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="text-muted fw-500 mb-2">Total Clients</h6>
                            <h3 class="fw-bold mb-0" style="color: #4e54c8;">{{ total_clients }}</h3>
                            <small class="text-success"><i class="bi bi-arrow-up"></i> Active</small>
                        </div>
                        <div class="rounded-circle bg-primary bg-opacity-10 p-3">
                            <i class="bi bi-people-fill text-primary" style="font-size: 1.5rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Active Meal Plans Card -->
        <div class="col-lg-3 col-md-6">
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="text-muted fw-500 mb-2">Active Meal Plans</h6>
                            <h3 class="fw-bold mb-0" style="color: #20c997;">{{ active_meal_plans }}</h3>
                            <small class="text-info"><i class="bi bi-arrow-up"></i> This week</small>
                        </div>
                        <div class="rounded-circle bg-success bg-opacity-10 p-3">
                            <i class="bi bi-clipboard-check text-success" style="font-size: 1.5rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pending Consultations Card -->
        <div class="col-lg-3 col-md-6">
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="text-muted fw-500 mb-2">Consultations</h6>
                            <h3 class="fw-bold mb-0" style="color: #ffc107;">{{ pending_consultations }}</h3>
                            <small class="text-warning"><i class="bi bi-clock"></i> Pending</small>
                        </div>
                        <div class="rounded-circle bg-warning bg-opacity-10 p-3">
                            <i class="bi bi-calendar2-event text-warning" style="font-size: 1.5rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Completion Rate Card -->
        <div class="col-lg-3 col-md-6">
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                <div class="card-body p-4">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <h6 class="text-muted fw-500 mb-2">Success Rate</h6>
                            <h3 class="fw-bold mb-0" style="color: #17a2b8;">{{ completion_rate }}%</h3>
                            <small class="text-success"><i class="bi bi-check-circle"></i> Average</small>
                        </div>
                        <div class="rounded-circle bg-info bg-opacity-10 p-3">
                            <i class="bi bi-graph-up text-info" style="font-size: 1.5rem;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== Quick Actions Section ===== -->
    <div class="row g-4 mb-4">
        <div class="col-12">
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                <div class="card-header bg-light border-bottom-0 p-4">
                    <h5 class="mb-0"><i class="bi bi-lightning-charge text-warning me-2"></i> Quick Actions</h5>
                </div>
                <div class="card-body p-4">
                    <div class="row g-3">
                        <div class="col-lg-3 col-md-6">
                            <a href="{% url 'nutritionist_dashboard:manage_clients' %}" class="text-decoration-none">
                                <div class="action-card p-4 text-center rounded-4 border border-light hover-shadow">
                                    <div class="rounded-circle bg-primary bg-opacity-10 p-3 mb-3 mx-auto" style="width: fit-content;">
                                        <i class="bi bi-people-fill text-primary" style="font-size: 1.5rem;"></i>
                                    </div>
                                    <h6 class="fw-bold mb-1">Manage Clients</h6>
                                    <p class="text-muted small mb-0">View & manage all clients</p>
                                </div>
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <a href="{% url 'nutritionist_dashboard:create_meal_plan' %}" class="text-decoration-none">
                                <div class="action-card p-4 text-center rounded-4 border border-light hover-shadow">
                                    <div class="rounded-circle bg-success bg-opacity-10 p-3 mb-3 mx-auto" style="width: fit-content;">
                                        <i class="bi bi-clipboard-plus text-success" style="font-size: 1.5rem;"></i>
                                    </div>
                                    <h6 class="fw-bold mb-1">Create Meal Plan</h6>
                                    <p class="text-muted small mb-0">Build new nutrition plan</p>
                                </div>
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <a href="{% url 'nutritionist_dashboard:schedule_consultation' %}" class="text-decoration-none">
                                <div class="action-card p-4 text-center rounded-4 border border-light hover-shadow">
                                    <div class="rounded-circle bg-warning bg-opacity-10 p-3 mb-3 mx-auto" style="width: fit-content;">
                                        <i class="bi bi-calendar-plus text-warning" style="font-size: 1.5rem;"></i>
                                    </div>
                                    <h6 class="fw-bold mb-1">Schedule Consultation</h6>
                                    <p class="text-muted small mb-0">Book client session</p>
                                </div>
                            </a>
                        </div>
                        <div class="col-lg-3 col-md-6">
                            <a href="{% url 'nutritionist_dashboard:settings' %}" class="text-decoration-none">
                                <div class="action-card p-4 text-center rounded-4 border border-light hover-shadow">
                                    <div class="rounded-circle bg-info bg-opacity-10 p-3 mb-3 mx-auto" style="width: fit-content;">
                                        <i class="bi bi-gear text-info" style="font-size: 1.5rem;"></i>
                                    </div>
                                    <h6 class="fw-bold mb-1">Settings</h6>
                                    <p class="text-muted small mb-0">Manage profile & rates</p>
                                </div>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== Main Content Sections ===== -->
    <div class="row g-4">
        <!-- Recent Clients Section -->
        <div class="col-lg-6">
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                <div class="card-header bg-light border-bottom-0 p-4 d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="bi bi-people-fill text-primary me-2"></i> Recent Clients</h5>
                    <a href="{% url 'nutritionist_dashboard:manage_clients' %}" class="btn btn-sm btn-outline-primary">View All</a>
                </div>
                <div class="card-body p-0">
                    {% if recent_clients %}
                        <div class="list-group list-group-flush">
                            {% for client in recent_clients %}
                            <a href="{% url 'nutritionist_dashboard:client_detail' client.id %}" class="list-group-item list-group-item-action p-4 border-bottom">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div class="d-flex gap-3 flex-grow-1">
                                        <img src="{% static 'img/default-avatar.png' %}" class="rounded-circle" style="width: 40px; height: 40px; object-fit: cover;">
                                        <div>
                                            <h6 class="fw-bold mb-1">{{ client.get_full_name|default:client.username }}</h6>
                                            <small class="text-muted">{{ client.email }}</small>
                                        </div>
                                    </div>
                                    <span class="badge bg-primary bg-opacity-10 text-primary rounded-pill">Active</span>
                                </div>
                            </a>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="p-4 text-center text-muted">
                            <i class="bi bi-inbox" style="font-size: 2rem;"></i>
                            <p class="mt-2 mb-0">No clients assigned yet</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Upcoming Consultations Section -->
        <div class="col-lg-6">
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                <div class="card-header bg-light border-bottom-0 p-4 d-flex justify-content-between align-items-center">
                    <h5 class="mb-0"><i class="bi bi-calendar-event text-warning me-2"></i> Upcoming Consultations</h5>
                    <a href="{% url 'nutritionist_dashboard:schedule_consultation' %}" class="btn btn-sm btn-outline-primary">Schedule</a>
                </div>
                <div class="card-body p-0">
                    {% if upcoming_consultations %}
                        <div class="list-group list-group-flush">
                            {% for consultation in upcoming_consultations %}
                            <div class="list-group-item p-4 border-bottom">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h6 class="fw-bold mb-1">{{ consultation.title }}</h6>
                                    <span class="badge bg-warning bg-opacity-10 text-warning rounded-pill">{{ consultation.get_status_display }}</span>
                                </div>
                                <div class="row g-2 text-muted small">
                                    <div class="col-6">
                                        <i class="bi bi-calendar"></i> {{ consultation.scheduled_date|date:"M d, Y" }}
                                    </div>
                                    <div class="col-6">
                                        <i class="bi bi-clock"></i> {{ consultation.scheduled_time|time:"H:i" }}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="p-4 text-center text-muted">
                            <i class="bi bi-calendar-x" style="font-size: 2rem;"></i>
                            <p class="mt-2 mb-0">No consultations scheduled</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- ===== Additional Sections ===== -->
    <div class="row g-4 mt-2 mb-4">
        <!-- Performance Metrics -->
        <div class="col-lg-6">
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                <div class="card-header bg-light border-bottom-0 p-4">
                    <h5 class="mb-0"><i class="bi bi-bar-chart text-success me-2"></i> Performance Metrics</h5>
                </div>
                <div class="card-body p-4">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-2">
                            <span>Client Engagement</span>
                            <span class="fw-bold">85%</span>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-success" style="width: 85%;"></div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between mb-2">
                            <span>Plan Completion</span>
                            <span class="fw-bold">72%</span>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-info" style="width: 72%;"></div>
                        </div>
                    </div>
                    <div>
                        <div class="d-flex justify-content-between mb-2">
                            <span>Client Satisfaction</span>
                            <span class="fw-bold">4.5/5</span>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar bg-warning" style="width: 90%;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Announcements & Tips -->
        <div class="col-lg-6">
            <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
                <div class="card-header bg-light border-bottom-0 p-4">
                    <h5 class="mb-0"><i class="bi bi-info-circle text-info me-2"></i> Resources & Tips</h5>
                </div>
                <div class="card-body p-4">
                    <div class="alert alert-info border-0 bg-info bg-opacity-10 mb-3">
                        <h6 class="fw-bold mb-2">Pro Tip: Seasonal Nutrition</h6>
                        <p class="mb-0 small">Adjust meal plans based on seasonal availability of produce for better client results.</p>
                    </div>
                    <div class="alert alert-success border-0 bg-success bg-opacity-10 mb-0">
                        <h6 class="fw-bold mb-2">Latest Update</h6>
                        <p class="mb-0 small">New nutrition calculator now available. Check it out in the tools section!</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== Styling ===== -->
    <style>
        .action-card {
            transition: all 0.3s ease;
            background: #f8f9fa;
        }
        .action-card:hover {
            background: white;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }
        .hover-shadow:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1) !important;
        }
    </style>
</div>
{% endblock %}

        <!-- Statistics Cards (existing) -->

        <!-- Get a Meal Plan Section -->
        <div class="dashboard-card gradient-success mb-4">
            <div class="card-header bg-transparent border-bottom-0">
                <h5 class="mb-0"><i class="bi bi-journal-text text-success me-2"></i> Get a Meal Plan</h5>
            </div>
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-md-8">
                        <h4 class="text-success mb-2">Save up to 30% with our subscription plans</h4>
                        <p class="text-muted mb-3">Weekly and monthly plans tailored for your health needs. Get
                            personalized meal plans designed by certified nutritionists.</p>
                        <div class="d-flex gap-3">
                            <a href="#" class="btn btn-success"><i class="bi bi-calendar-week me-2"></i> Weekly Plan</a>
                            <a href="#" class="btn btn-outline-success"><i class="bi bi-calendar-month me-2"></i>
                                Monthly Plan</a>
                        </div>
                    </div>
                    <div class="col-md-4 text-center">
                        <div class="bg-success bg-opacity-10 p-4 rounded-circle d-inline-block">
                            <i class="bi bi-percent text-success" style="font-size: 3rem;"></i>
                        </div>
                        <h3 class="mt-3 text-success">30% OFF</h3>
                    </div>
                </div>
            </div>
        </div>

        <!-- Health Snapshot Section -->
        <div class="dashboard-card gradient-danger mb-4">
            <div class="card-header bg-transparent border-bottom-0 d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="bi bi-heart-pulse text-danger me-2"></i> Health Snapshot</h5>
                <a href="{% url 'nutritionist_dashboard:update_profile' %}"
                    class="btn btn-outline-danger btn-sm">Complete Profile</a>
            </div>
            <div class="card-body text-center py-4">
                <div class="mb-3"><i class="bi bi-clipboard2-pulse text-muted" style="font-size: 3rem;"></i></div>
                <h4 class="mb-2">Complete your health profile</h4>
                <p class="text-muted mb-4">Fill out your health information to see your vital statistics, track
                    progress, and get personalized recommendations.</p>
                <a href="{% url 'nutritionist_dashboard:update_profile' %}" class="btn btn-danger"><i
                        class="bi bi-clipboard-plus me-2"></i> Complete Health Profile</a>
            </div>
        </div>

        <!-- Quick Actions Section -->
        <div class="dashboard-card mb-4">
            <div class="card-header">
                <h5 class="mb-0"><i class="bi bi-lightning-charge text-warning me-2"></i> Quick Actions</h5>
            </div>
            <div class="card-body">
                <div class="quick-actions-grid">
                    <a href="{% url 'nutritionist_dashboard:schedule_consultation' %}" class="quick-action-btn">
                        <div class="quick-action-icon bg-primary bg-opacity-10 text-primary"><i
                                class="bi bi-calendar-plus"></i></div>
                        <div class="quick-action-title">Schedule</div>
                        <div class="quick-action-desc">Consultation</div>
                    </a>
                    <a href="{% url 'nutritionist_dashboard:create_meal_plan' %}" class="quick-action-btn">
                        <div class="quick-action-icon bg-success bg-opacity-10 text-success"><i
                                class="bi bi-clipboard-plus"></i></div>
                        <div class="quick-action-title">Create</div>
                        <div class="quick-action-desc">Meal Plan</div>
                    </a>
                    <a href="{% url 'nutritionist_dashboard:create_recommendation' %}" class="quick-action-btn">
                        <div class="quick-action-icon bg-info bg-opacity-10 text-info"><i
                                class="bi bi-chat-square-text"></i></div>
                        <div class="quick-action-title">Add</div>
                        <div class="quick-action-desc">Recommendation</div>
                    </a>
                    <a href="{% url 'nutritionist_dashboard:manage_clients' %}" class="quick-action-btn">
                        <div class="quick-action-icon quick-action-icon-purple"><i class="bi bi-people"></i></div>
                        <div class="quick-action-title">Manage</div>
                        <div class="quick-action-desc">Clients</div>
                    </a>
                </div>
            </div>
        </div>

        <!-- Continue with existing Main Content Grid -->
        <div class="content-grid">
            <!-- Left and Right Columns as in your current template -->
        </div>
    </div>
</div>
{% endblock %}