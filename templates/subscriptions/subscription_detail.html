{% extends 'base.html' %}
{% load static %}

{% block title %}Subscription Details - Dusangire{% endblock %}

{% block extra_css %}
<style>
    .detail-hero {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 1rem;
        padding: 2.5rem;
        margin-bottom: 2rem;
        box-shadow: 0 0.5rem 1.5rem rgba(102, 126, 234, 0.3);
    }

    .detail-hero.active {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    }

    .detail-hero.paused {
        background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
    }

    .detail-hero.cancelled {
        background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
    }

    .info-card {
        border: none;
        border-radius: 1rem;
        box-shadow: 0 0.125rem 0.5rem rgba(0, 0, 0, 0.08);
        margin-bottom: 1.5rem;
        overflow: hidden;
    }

    .info-card-header {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        padding: 1.25rem 1.5rem;
        border-bottom: 2px solid #dee2e6;
        font-weight: 700;
        color: #212529;
    }

    .info-card-body {
        padding: 1.5rem;
    }

    .info-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 1rem 0;
        border-bottom: 1px solid #f0f0f0;
    }

    .info-row:last-child {
        border-bottom: none;
    }

    .info-label {
        color: #6c757d;
        font-weight: 500;
        display: flex;
        align-items: center;
    }

    .info-label i {
        margin-right: 0.5rem;
        color: #0d6efd;
        width: 20px;
    }

    .info-value {
        font-weight: 600;
        color: #212529;
        text-align: right;
    }

    .status-badge-large {
        padding: 0.5rem 1.25rem;
        border-radius: 2rem;
        font-weight: 600;
        font-size: 0.9rem;
        display: inline-block;
    }

    .table-modern {
        border-radius: 0.5rem;
        overflow: hidden;
    }

    .table-modern thead {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    }

    .table-modern thead th {
        border: none;
        padding: 1rem;
        font-weight: 600;
        color: #212529;
        text-transform: uppercase;
        font-size: 0.85rem;
        letter-spacing: 0.5px;
    }

    .table-modern tbody tr {
        border-bottom: 1px solid #f0f0f0;
        transition: all 0.2s ease;
    }

    .table-modern tbody tr:hover {
        background: #f8f9fa;
        transform: scale(1.01);
    }

    .table-modern tbody td {
        padding: 1rem;
        vertical-align: middle;
    }

    .action-card {
        border: none;
        border-radius: 1rem;
        box-shadow: 0 0.125rem 0.5rem rgba(0, 0, 0, 0.08);
        overflow: hidden;
    }

    .action-card-header {
        background: linear-gradient(135deg, #0d6efd 0%, #0056b3 100%);
        color: white;
        padding: 1.25rem 1.5rem;
        font-weight: 700;
    }

    .action-card-body {
        padding: 1.5rem;
    }

    .btn-action-detail {
        width: 100%;
        margin-bottom: 0.75rem;
        border-radius: 0.5rem;
        font-weight: 600;
        padding: 0.75rem 1rem;
        transition: all 0.3s ease;
    }

    .btn-action-detail:hover {
        transform: translateY(-2px);
        box-shadow: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.15);
    }

    .btn-action-detail:last-child {
        margin-bottom: 0;
    }

    .stats-grid-detail {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
        margin: 1.5rem 0;
    }

    .stat-card-detail {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border-radius: 0.75rem;
        padding: 1.25rem;
        text-align: center;
        border: 1px solid #e0e0e0;
    }

    .stat-value-detail {
        font-size: 1.5rem;
        font-weight: 700;
        color: #0d6efd;
        margin-bottom: 0.25rem;
    }

    .stat-label-detail {
        font-size: 0.875rem;
        color: #6c757d;
        font-weight: 500;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4 mb-5">
    <!-- Hero Section -->
    <div
        class="detail-hero {% if subscription.status == 'active' %}active{% elif subscription.status == 'paused' %}paused{% else %}cancelled{% endif %}">
        <div class="d-flex justify-content-between align-items-center flex-wrap">
            <div>
                <h1 class="mb-2" style="font-weight: 700;">{{ subscription.plan.name }}</h1>
                <p class="mb-0 opacity-90" style="font-size: 1.1rem;">
                    <span class="badge bg-light text-dark px-3 py-2" style="border-radius: 2rem;">
                        {{ subscription.plan.get_plan_type_display }} Plan
                    </span>
                </p>
            </div>
            <div class="mt-3 mt-md-0">
                <span class="status-badge-large bg-light text-dark">
                    <i
                        class="bi bi-{% if subscription.status == 'active' %}check-circle-fill{% elif subscription.status == 'paused' %}pause-circle-fill{% else %}x-circle-fill{% endif %}"></i>
                    {{ subscription.get_status_display }}
                </span>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-8">
            <!-- Subscription Information -->
            <div class="card info-card">
                <div class="info-card-header">
                    <i class="bi bi-info-circle"></i> Subscription Information
                </div>
                <div class="info-card-body">
                    <div class="stats-grid-detail">
                        <div class="stat-card-detail">
                            <div class="stat-value-detail">RWF {{ subscription.plan.get_discounted_price|floatformat:0
                                }}</div>
                            <div class="stat-label-detail">Price per {{ subscription.plan.get_plan_type_display|lower }}
                            </div>
                        </div>
                        <div class="stat-card-detail">
                            <div class="stat-value-detail">{{ subscription.plan.meals_per_cycle }}</div>
                            <div class="stat-label-detail">Meals per Cycle</div>
                        </div>
                    </div>

                    <div class="info-row">
                        <div class="info-label">
                            <i class="bi bi-calendar-event"></i>
                            <span>Start Date</span>
                        </div>
                        <div class="info-value">{{ subscription.start_date|date:"F d, Y" }}</div>
                    </div>
                    <div class="info-row">
                        <div class="info-label">
                            <i class="bi bi-calendar-x"></i>
                            <span>End Date</span>
                        </div>
                        <div class="info-value">{{ subscription.end_date|date:"F d, Y" }}</div>
                    </div>
                    {% if subscription.is_active %}
                    <div class="info-row">
                        <div class="info-label">
                            <i class="bi bi-hourglass-split"></i>
                            <span>Days Remaining</span>
                        </div>
                        <div class="info-value">
                            <span class="badge bg-info fs-6">{{ subscription.days_remaining }} days</span>
                        </div>
                    </div>
                    {% endif %}
                    <div class="info-row">
                        <div class="info-label">
                            <i class="bi bi-clock"></i>
                            <span>Preferred Delivery Time</span>
                        </div>
                        <div class="info-value">
                            {% if subscription.preferred_delivery_time %}
                            {{ subscription.preferred_delivery_time|time:"H:i" }}
                            {% else %}
                            <span class="text-muted">Not set</span>
                            {% endif %}
                        </div>
                    </div>
                    {% if subscription.dietary_preferences %}
                    <div class="info-row">
                        <div class="info-label">
                            <i class="bi bi-heart"></i>
                            <span>Dietary Preferences</span>
                        </div>
                        <div class="info-value">{{ subscription.dietary_preferences }}</div>
                    </div>
                    {% endif %}
                    <div class="info-row">
                        <div class="info-label">
                            <i class="bi bi-arrow-repeat"></i>
                            <span>Auto-Order</span>
                        </div>
                        <div class="info-value">
                            {% if subscription.auto_order_enabled %}
                            <span class="badge bg-success">Enabled</span>
                            {% else %}
                            <span class="badge bg-secondary">Disabled</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Subscription Orders -->
            <div class="card info-card">
                <div class="info-card-header">
                    <i class="bi bi-list-ul"></i> Subscription Orders
                </div>
                <div class="info-card-body">
                    {% if subscription_orders %}
                    <div class="table-responsive">
                        <table class="table table-modern">
                            <thead>
                                <tr>
                                    <th>Order #</th>
                                    <th>Scheduled Date</th>
                                    <th>Status</th>
                                    <th>Total</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for sub_order in subscription_orders %}
                                <tr>
                                    <td>
                                        <strong style="color: #0d6efd;">{{ sub_order.order.order_number }}</strong>
                                    </td>
                                    <td>{{ sub_order.scheduled_date|date:"M d, Y" }}</td>
                                    <td>
                                        <span class="badge bg-{{ sub_order.order.get_status_display_class }} px-3 py-2">
                                            {{ sub_order.order.get_status_display }}
                                        </span>
                                    </td>
                                    <td>
                                        <strong>RWF {{ sub_order.order.total|floatformat:0 }}</strong>
                                    </td>
                                    <td>
                                        <a href="{% url 'orders:order_detail' sub_order.order.id %}"
                                            class="btn btn-sm btn-outline-primary" style="border-radius: 0.5rem;">
                                            <i class="bi bi-eye"></i> View
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="text-center py-4">
                        <i class="bi bi-inbox" style="font-size: 3rem; color: #dee2e6;"></i>
                        <p class="text-muted mt-3 mb-0">No orders generated yet from this subscription.</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Actions Card -->
            <div class="card action-card mb-3">
                <div class="action-card-header">
                    <i class="bi bi-gear"></i> Actions
                </div>
                <div class="action-card-body">
                    {% if subscription.status == 'active' %}
                    <a href="{% url 'subscriptions:update' subscription.id %}"
                        class="btn btn-primary btn-action-detail">
                        <i class="bi bi-pencil"></i> Update Preferences
                    </a>
                    <a href="{% url 'subscriptions:pause' subscription.id %}"
                        class="btn btn-outline-warning btn-action-detail">
                        <i class="bi bi-pause-circle"></i> Pause Subscription
                    </a>
                    <a href="{% url 'subscriptions:cancel' subscription.id %}"
                        class="btn btn-outline-danger btn-action-detail">
                        <i class="bi bi-x-circle"></i> Cancel Subscription
                    </a>
                    {% elif subscription.status == 'paused' %}
                    <a href="{% url 'subscriptions:resume' subscription.id %}"
                        class="btn btn-success btn-action-detail">
                        <i class="bi bi-play-circle"></i> Resume Subscription
                    </a>
                    <a href="{% url 'subscriptions:cancel' subscription.id %}"
                        class="btn btn-outline-danger btn-action-detail">
                        <i class="bi bi-x-circle"></i> Cancel Subscription
                    </a>
                    {% endif %}
                </div>
            </div>

            <!-- Back Button -->
            <a href="{% url 'subscriptions:my_subscriptions' %}" class="btn btn-outline-secondary w-100"
                style="border-radius: 0.5rem; font-weight: 600; padding: 0.75rem;">
                <i class="bi bi-arrow-left"></i> Back to Subscriptions
            </a>
        </div>
    </div>
</div>
{% endblock %}