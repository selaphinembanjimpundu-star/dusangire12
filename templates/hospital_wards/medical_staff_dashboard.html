{% extends "base.html" %}
{% load static %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="container-fluid py-4" style="background-color: #f8fafc;">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-md-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h2 mb-0" style="color: #1e40af;">
                        <i class="fas fa-stethoscope"></i> Medical Ward Dashboard
                    </h1>
                    <p class="text-muted mt-2">Hospital Ward & Patient Care Management</p>
                </div>
                <div style="background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); color: white; padding: 20px 30px; border-radius: 8px;">
                    <div class="small">Last Updated</div>
                    <div class="font-weight-bold">Just Now</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Key Metrics Row - Healthcare Color Scheme -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card shadow-sm border-0 h-100" style="border-top: 4px solid #10b981;">
                <div class="card-body">
                    <div style="color: #10b981; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;">Hospital Beds</div>
                    <div class="h2 mb-0 font-weight-bold" style="color: #065f46;">{{ total_beds }}</div>
                    <div class="small text-muted mt-2">
                        <span style="color: #dc2626;">{{ occupied_beds }}</span> occupied â€¢ 
                        <span style="color: #10b981;">{{ available_beds }}</span> available
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card shadow-sm border-0 h-100" style="border-top: 4px solid #3b82f6;">
                <div class="card-body">
                    <div style="color: #3b82f6; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;">Active Patients</div>
                    <div class="h2 mb-0 font-weight-bold" style="color: #1e40af;">{{ occupied_beds }}</div>
                    <div class="small text-muted mt-2">Under active care</div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card shadow-sm border-0 h-100" style="border-top: 4px solid #8b5cf6;">
                <div class="card-body">
                    <div style="color: #8b5cf6; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;">Ward Departments</div>
                    <div class="h2 mb-0 font-weight-bold" style="color: #5b21b6;">{{ wards|length }}</div>
                    <div class="small text-muted mt-2">Active wards</div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card shadow-sm border-0 h-100" style="border-top: 4px solid #f59e0b;">
                <div class="card-body">
                    <div style="color: #f59e0b; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px;">Occupancy Rate</div>
                    <div class="h2 mb-0 font-weight-bold" style="color: #92400e;">{% widthratio occupied_beds total_beds 100 %}%</div>
                    <div class="small text-muted mt-2">Current hospital occupancy</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Row -->
    <div class="row">
        <!-- Recent Admissions -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm border-0">
                <div class="card-header" style="background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%); color: white; border-bottom: none;">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="m-0 font-weight-bold"><i class="fas fa-sign-in-alt"></i> Recent Admissions</h6>
                        <span class="badge badge-light text-primary">{{ recent_admissions|length }}</span>
                    </div>
                </div>
                <div class="card-body">
                    {% if recent_admissions %}
                        <div class="table-responsive">
                            <table class="table table-sm table-hover">
                                <thead class="table-light">
                                    <tr>
                                        <th>Patient</th>
                                        <th>Ward</th>
                                        <th>Date</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for admission in recent_admissions %}
                                    <tr>
                                        <td>
                                            <strong>{{ admission.patient.first_name }} {{ admission.patient.last_name }}</strong>
                                        </td>
                                        <td>{{ admission.ward.name }}</td>
                                        <td>{{ admission.admission_date|date:"M d, Y" }}</td>
                                        <td>
                                            <span class="badge badge-success">Admitted</span>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <p class="text-muted text-center py-3">No recent admissions</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Pending Discharges -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm border-0">
                <div class="card-header" style="background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%); color: white; border-bottom: none;">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="m-0 font-weight-bold"><i class="fas fa-sign-out-alt"></i> Pending Discharges</h6>
                        <span class="badge badge-light text-danger">{{ pending_discharges|length }}</span>
                    </div>
                </div>
                <div class="card-body">
                    {% if pending_discharges %}
                        <div class="table-responsive">
                            <table class="table table-sm table-hover">
                                <thead class="table-light">
                                    <tr>
                                        <th>Patient</th>
                                        <th>Expected Date</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for discharge in pending_discharges %}
                                    <tr>
                                        <td>
                                            <strong>{{ discharge.patient.first_name }} {{ discharge.patient.last_name }}</strong>
                                        </td>
                                        <td>{{ discharge.expected_discharge_date|date:"M d, Y"|default:"TBD" }}</td>
                                        <td>
                                            <a href="#" class="btn btn-sm btn-outline-primary">Process</a>
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <p class="text-muted text-center py-3">No pending discharges</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Second Row -->
    <div class="row">
        <!-- Patient Education Progress -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm border-0" style="border-top: 4px solid #10b981;">
                <div class="card-body">
                    <h6 class="mb-3" style="color: #065f46; font-weight: 700;">
                        <i class="fas fa-graduation-cap"></i> Patient Education Progress
                    </h6>
                    <div class="h3 mb-2 font-weight-bold" style="color: #10b981;">{{ education_progress }}</div>
                    <p class="small text-muted">Patients completed education in last 7 days</p>
                    <div class="progress mt-3" style="height: 8px;">
                        <div class="progress-bar" role="progressbar" style="width: 65%; background: linear-gradient(90deg, #10b981, #34d399);"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ward Nutritional Programs -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm border-0" style="border-top: 4px solid #f59e0b;">
                <div class="card-body">
                    <h6 class="mb-3" style="color: #92400e; font-weight: 700;">
                        <i class="fas fa-apple-alt"></i> Nutrition Programs
                    </h6>
                    <div class="h3 mb-2 font-weight-bold" style="color: #f59e0b;">{{ nutrition_programs }}</div>
                    <p class="small text-muted">Active nutrition and meal programs</p>
                    <a href="#" class="btn btn-sm mt-3" style="background: #f59e0b; color: white; border: none;">Manage Programs</a>
                </div>
            </div>
        </div>
    </div>

    <!-- Ward List -->
    <div class="row">
        <div class="col-md-12">
            <div class="card shadow-sm border-0">
                <div class="card-header" style="background: linear-gradient(135deg, #065f46 0%, #10b981 100%); color: white; border-bottom: none;">
                    <h6 class="m-0 font-weight-bold">
                        <i class="fas fa-hospital"></i> Active Hospital Wards
                    </h6>
                </div>
                <div class="card-body">
                    {% if wards %}
                        <div class="row">
                            {% for ward in wards %}
                            <div class="col-md-4 mb-3">
                                <div class="card border-left-primary">
                                    <div class="card-body">
                                        <h5 class="card-title">{{ ward.name }}</h5>
                                        <p class="card-text text-muted small">{{ ward.location }}</p>
                                        <div class="d-flex justify-content-between">
                                            <small><strong>Capacity:</strong> {{ ward.capacity }}</small>
                                            {% if ward.get_availability %}
                                                <small class="text-success"><strong>Available:</strong> {{ ward.get_available_beds_count }}</small>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-muted text-center py-3">No active wards</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Healthcare Color Scheme */
:root {
  --clinical-blue: #1e40af;
  --medical-green: #10b981;
  --alert-red: #dc2626;
  --info-purple: #8b5cf6;
  --caution-amber: #f59e0b;
}

.card {
  transition: all 0.3s ease;
}

.card:hover {
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1) !important;
  transform: translateY(-2px);
}

.table-hover tbody tr:hover {
  background-color: #f0fdf4;
}
</style>
{% endblock %}
